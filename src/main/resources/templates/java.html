<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>코드편집</title>
    <th:block th:insert="~{layout/head :: head}"></th:block>
    <link th:href="@{/static/css/java.css}" rel="stylesheet">
    <script th:src="@{/static/js/split.min.js}"></script>
    <link rel="stylesheet" data-name="vs/editor/editor.main" th:href="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.css}"/>
    <script>var require = {paths: {'vs': '../static/node_modules/monaco-editor/min/vs'}};</script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/loader.js}"></script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.nls.js}"></script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.js}"></script>
    <script src="https://unpkg.com/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.14/css/gijgo.min.css" rel="stylesheet" type="text/css" />

</head>
<body>
<nav class="navbar navbar-light bg-dark" >
    <a th:href="@{/}" style="padding: 1px"><img th:src="@{/static/img/logo/logo.png}" alt="로고이미지" title="tcoding 로고" id="logoImage"></a>
</nav>

<div class="container-fluid">
    <div class="row">
        <div style="padding:0;">
            <div id="split-container">
                <div id="left-pane" style="width: 16%">
                    <div class="tree-topbar">
                        <div class="d-flex float-end" id="newF">
                            <img th:src="@{/static/img/icon/newFolder.svg}" alt="폴더생성" id="popupBtn" title="폴더생성">
                            <img th:src="@{/static/img/icon/newFile.svg}" alt="파일생성" id="popupBtn2" title="파일생성">
                        </div>
                    </div>
                    <div id="tree" style=""></div>
                </div>

                <div id="center-pane" style="width: 60%; z-index: 0; background-color: #1e1e1e;">
                    <div class="editor-info">
                        <p id="selectedFileName" title="파일경로" style="float: left; margin: 12px; font-size: 12px;"></p>
                        <div class="d-flex float-end m-1">
                            <img th:src="@{/static/img/icon/download.svg}" id="saveBtn" alt="다운로드" title="다운로드">
                            <img th:src="@{/static/img/icon/saveNewname.svg}" alt="다른이름으로저장" title="다른이름으로저장">
                            <input type="hidden" name="downloadName" id="downloadName">
                            <input type="text" name="filename" id="filename">
                            <img th:src="@{/static/img/icon/save.svg}" id="btn1" alt="저장" title="저장">
                            <button onclick="send_compiler();" type="button" class="btn btn-danger float-end mx-2" id="run"><img th:src="@{/static/img/icon/play.svg}" alt="컴파일" id="compileImg" title="컴파일">&nbsp;RUN</button>
                        </div>
                    </div>

                    <pre id="monaco"></pre>
                </div>

                <div id="right-pane" style="background-color: #cccccc; width: 24%;">
                    <div>
                        <p style="border-bottom: 2px solid #afafaf; padding-bottom: 6px; padding-top: 4px;">시간시간시간</p>
                        <div id="output" style="flex:1 1 auto; padding-left:10px;">실행 결과가 여기에 표시됩니다.</div>
                    </div>
                </div>
            </div>


            <div id="iconNav">
                <a><i class="fa-solid fa-user" style="color:#fff;"></i></a>
                <div id="balloon-wrap">
                    <ul id="balloon">
                        <th:block sec:authorize="hasRole('USER')">
                            <li><a th:href="@{/member/mypage}">마이페이지</a></li>
                        </th:block>
                        <th:block sec:authorize="hasRole('ADMIN')">
                            <li><a th:href="@{/admin/dash}">관리자페이지</a></li>
                        </th:block>
                        <li><a th:href="@{/logout}">로그아웃</a></li>
                    </ul>
                </div>
            </div>


<!--            <div class="form-wrap" style="display: none;">-->
<!--                <hr>-->
<!--                <h4>파일 저장</h4>-->
<!--                <input type="text" name="filename" id="filename">-->
<!--                <input type="hidden" name="downloadName" id="downloadName">-->
<!--                <button type="button" id="btn1" class="btn btn-primary">저장</button>-->
<!--                <hr>-->
<!--                <h4>파일 다운로드</h4>-->
<!--                <button type="button" id="saveBtn" class="btn btn-primary">다운로드</button>-->
<!--                <button type="button" id="saveZip" class="btn btn-primary">ZIP 다운로드</button>-->
<!--                <hr>-->
<!--                <input type="text" name="mkdirname" id="mkdirname" placeholder="폴더명" oninput="validateInput(this)">-->
<!--                <button type="button" id="mkdir2" class="btn btn-primary">폴더 생성</button>-->
<!--                선택한 위치 기준으로 생성-->
<!--                <hr>-->
<!--            </div>-->
        </div>
    </div>

    <div id="modalWrap">
        <div id="modalBody">
            <span id="closeBtn">&times;</span>
            <form class="row g-3" id="modalContent">
                <div class="col-auto">
                   <strong>폴더명</strong>
                </div>
                <div class="col-auto">
                    <input type="text" class="form-control" name="mkdirname" id="mkdirname" placeholder="폴더명" oninput="validateInput(this)">
                </div>
                <div class="col-auto">
                    <button type="button" id="mkdir2" class="btn btn-secondary mb-3">폴더 생성</button>

                </div>
            </form>
            <p id="infoModal">* 선택한 위치 기준으로 생성</p>
        </div>
    </div>

    <div id="modalWrap2">
        <div id="modalBody2">
            <span id="closeBtn2">&times;</span>
            <form class="row g-3" id="modalContent2">
                <div class="col-auto">
                    <strong>파일명</strong>
                </div>
                <div class="col-auto">
                    <input type="text" class="form-control" name="newFile" id="newFile" placeholder="파일명" oninput="validateInput(this)">
                </div>
                <div class="col-auto">
                    <button type="button" id="newFile2" class="btn btn-secondary mb-3">파일 생성</button>
                </div>
            </form>
        </div>
    </div>


</div>
<script>
    const btn = document.getElementById('popupBtn');
    const modal = document.getElementById('modalWrap');
    const closeBtn = document.getElementById('closeBtn');

    const btn2 = document.getElementById('popupBtn2');
    const modal2 = document.getElementById('modalWrap2');
    const closeBtn2 = document.getElementById('closeBtn2');

    const icon = document.getElementById('iconNav');
    const balloon = document.getElementById('balloon');

    btn.onclick = function() {
        modal.style.display = 'block';
    }
    closeBtn.onclick = function() {
        modal.style.display = 'none';
    }

    window.onclick = function(event) {
        if (event.target == modal || event.target == modal2) {
            modal.style.display = "none";
            modal2.style.display = "none";
        }
    }

    btn2.onclick = function() {
        modal2.style.display = 'block';
    }
    closeBtn2.onclick = function() {
        modal2.style.display = 'none';
    }


    icon.addEventListener('mouseenter', function (){
        balloon.style.display = 'block';
    })

    icon.addEventListener('mouseover', function (){
        console.log("bye");
        balloon.style.display = 'block';
    })

    icon.addEventListener('mouseout', function (){
        balloon.style.display = 'none';
    })
</script>

<script th:src="@{/static/js/javaEditor.js}" th:inline="javascript"></script>
</body>
</html>