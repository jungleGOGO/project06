<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" data-name="vs/editor/editor.main" th:href="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.css}"/>
    <script>var require = {paths: {'vs': '../node_modules/monaco-editor/min/vs'}};</script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/loader.js}"></script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.nls.js}"></script>
    <script th:src="@{/static/node_modules/monaco-editor/min/vs/editor/editor.main.js}"></script>
    <title>메인</title>
    <style>
        #monaco { min-height:300px; }
    </style>
</head>
<body>
<div>
    <h2>온라인 코드 에디터</h2>
    <div class="form-wrap">
        <select name="language" id="language" onchange="changeLanguage()">
            <option value="java" selected>JAVA</option>
            <option value="javascript">Javascript</option>
            <option value="html">HTML</option>
            <option value="css">CSS</option>
        </select>
    </div>
    <pre id="monaco"></pre>
    <div class="form-wrap">
        <input type="text" name="filename" id="filename">
        <div id="fileExplorer" style="float: left;"></div>

        <button type="button" id="saveBtn" class="btn btn-primary">저장</button>
    </div>
</div>

<script th:inline="javascript">
    var editor;

    function setEditorOptions(inputValue, inputLanguage) {
        return {
            value: inputValue,          //처음에 표시되는 내용
            language: inputLanguage,    //언어 종류
            theme: "vs-dark",
            lineNumbers: 'on',
            glyphMargin: false,
            vertical: 'auto',
            horizontal: 'auto',
            verticalScrollbarSize: 10,
            horizontalScrollbarSize: 10,
            scrollBeyondLastLine: false,
            readOnly: false,
            automaticLayout: true,
            minimap: {
                enabled: true
            },
            lineHeight: 19
        };
    }

    function createEditor(inputValue, inputLanguage) {
        if (editor) {
            editor.dispose();
        }

        editor = monaco.editor.create(document.getElementById('monaco'), setEditorOptions(inputValue, inputLanguage));

        $('#monaco').height((editor.getModel().getLineCount() * 19) + 10);
    }

    /*<![CDATA[*/
    createEditor('public class test { \n }','java');
    /*]]>*/

    function changeLanguage() {
        var selectBox = document.getElementById('language');
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        createEditor("", selectedValue);
    }


    //
    // document.getElementById("btn1").addEventListener("click", () => {
    //     var viewLinesElements = document.getElementsByClassName("view-line");
    //
    //     var allTextValues = [];
    //
    //     for (var i = 0; i < viewLinesElements.length; i++) {
    //         var viewLinesElement = viewLinesElements[i];
    //         var textValue = viewLinesElement.textContent;
    //         allTextValues.push(textValue);
    //     }
    //
    //     console.log(allTextValues);
    // })
    document.getElementById("saveBtn").addEventListener("click", () => {
        var viewLinesElements = document.getElementsByClassName("view-line");
        var allTextValues = [];

        for (var i = 0; i < viewLinesElements.length; i++) {
            var viewLinesElement = viewLinesElements[i];
            var textValue = viewLinesElement.textContent;
            allTextValues.push(textValue);
        }
        var textToSave = allTextValues.join('\n');

        var blob = new Blob([textToSave], { type: "text/plain" });

        var a = document.createElement("a");
        a.style.display = "none";
        a.href = window.URL.createObjectURL(blob);
        a.download = document.getElementById('filename').value; // 사용자가 원하는 파일명 지정

        document.body.appendChild(a);
        a.click();

        window.URL.revokeObjectURL(a.href);
        document.body.removeChild(a);
    });


</script>
</body>
</html>